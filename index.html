<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WeatherNow | Informasi Cuaca</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2563EB',   // blue-600
            secondary: '#1E40AF', // blue-800
            soft: '#EFF6FF',      // blue-50
            rain: '#93C5FD',
            cloud: '#CBD5E1',
            sun: '#FDE68A',
            night: '#1E3A8A'
          }
        }
      }
    }
  </script>

  <style>
    /* Animasi icon cuaca */
    .weather-icon {
      animation: float 2s ease-in-out infinite;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .collapse-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease, padding 0.3s ease;
  padding: 0 1rem; /* padding horizontal tetap */
}
.collapse-content.show {
  max-height: 500px;
  padding: 0.75rem 1rem; /* padding vertikal muncul saat show */
}
.collapse-content {
  display: none; /* fully hidden */
}

.collapse-content.show {
  display: block; /* muncul saat diklik */
}


  </style>
</head>
<body class="bg-soft min-h-screen flex flex-col items-center justify-start font-sans py-10 transition-colors duration-500">

  <div class="bg-white w-full max-w-md rounded-2xl shadow-lg p-6 mb-6 transition-all duration-500">
    <!-- Header -->
    <h1 class="text-2xl font-semibold text-secondary text-center">
      WeatherNow
    </h1>
    <p class="text-sm text-gray-500 text-center mb-6">
      Informasi cuaca realtime
    </p>

    <!-- Input -->
    <div class="flex gap-2 mb-4">
      <input
        id="cityInput"
        type="text"
        placeholder="Masukkan nama kota"
        class="w-full border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary"
      />
      <button
        onclick="getWeather()"
        class="bg-primary text-white px-4 rounded-lg hover:bg-secondary transition"
      >
        Cari
      </button>
    </div>

    <!-- Result -->
    <div id="result" class="hidden text-center">
      <h2 id="cityName" class="text-xl font-semibold text-secondary"></h2>
      <p id="localTime" class="text-gray-500 text-sm mb-2"></p>
      <img id="weatherIcon" class="mx-auto my-3 w-20 weather-icon" />
      <p id="temperature" class="text-4xl font-bold text-primary"></p>
      <p id="description" class="text-gray-600 capitalize"></p>

      <div class="grid grid-cols-2 gap-4 mt-6 text-sm">
        <div class="bg-soft rounded-lg p-3">
          <p class="text-gray-500">Kelembapan</p>
          <p id="humidity" class="font-semibold text-secondary"></p>
        </div>
        <div class="bg-soft rounded-lg p-3">
          <p class="text-gray-500">Angin</p>
          <p id="wind" class="font-semibold text-secondary"></p>
        </div>
      </div>
    </div>

    <!-- Error -->
    <p id="error" class="text-center text-red-500 mt-4 hidden">
      Kota tidak ditemukan
    </p>
  </div>

  <!-- History -->
  <div id="historyContainer" class="bg-white w-full max-w-md rounded-2xl shadow-lg p-4 mb-6 hidden">
    <h3 class="text-lg font-semibold text-secondary mb-2">History Pencarian</h3>
    <ul id="historyList" class="space-y-2 text-gray-700">
      <!-- History akan muncul di sini -->
    </ul>
  </div>

  <script>
    const apiKey = "aff95024f4a44ffdb9f6676960870786";

    const cityInput = document.getElementById("cityInput");
    const result = document.getElementById("result");
    const error = document.getElementById("error");
    const cityName = document.getElementById("cityName");
    const localTime = document.getElementById("localTime");
    const temperature = document.getElementById("temperature");
    const description = document.getElementById("description");
    const humidity = document.getElementById("humidity");
    const wind = document.getElementById("wind");
    const weatherIcon = document.getElementById("weatherIcon");
    const historyContainer = document.getElementById("historyContainer");
    const historyList = document.getElementById("historyList");

    let history = [];

    async function getWeather() {
      const city = cityInput.value.trim();
      if (city === "") return;

      try {
        const response = await fetch(
          `https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&lang=id&appid=${apiKey}`
        );

        if (!response.ok) throw new Error("Kota tidak ditemukan");
        const data = await response.json();

        // Background sesuai cuaca
        const mainWeather = data.weather[0].main.toLowerCase();
        switch(mainWeather){
          case 'clear': document.body.className="bg-sun min-h-screen flex flex-col items-center justify-start font-sans py-10 transition-colors duration-500"; break;
          case 'clouds': document.body.className="bg-cloud min-h-screen flex flex-col items-center justify-start font-sans py-10 transition-colors duration-500"; break;
          case 'rain':
          case 'drizzle': document.body.className="bg-rain min-h-screen flex flex-col items-center justify-start font-sans py-10 transition-colors duration-500"; break;
          case 'thunderstorm': document.body.className="bg-secondary min-h-screen flex flex-col items-center justify-start font-sans py-10 transition-colors duration-500"; break;
          default: document.body.className="bg-soft min-h-screen flex flex-col items-center justify-start font-sans py-10 transition-colors duration-500";
        }

        // Tampilkan hasil utama
        cityName.textContent = data.name;

        // Waktu lokal kota
        const utcOffset = data.timezone; // detik
        const local = new Date(new Date().getTime() + utcOffset*1000 - new Date().getTimezoneOffset()*60000);
        const localString = local.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        localTime.textContent = "Waktu lokal: " + localString;

        // Animasi suhu
        let temp = 0;
        const targetTemp = Math.round(data.main.temp);
        temperature.textContent = "0°C";
        const interval = setInterval(()=>{
          if(temp >= targetTemp){
            clearInterval(interval);
            temperature.textContent = targetTemp + "°C";
          } else {
            temp++;
            temperature.textContent = temp + "°C";
          }
        }, 30);

        description.textContent = data.weather[0].description;
        humidity.textContent = `${data.main.humidity}%`;
        wind.textContent = `${data.wind.speed} m/s`;
        weatherIcon.src = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;

        result.classList.remove("hidden");
        error.classList.add("hidden");

        // Tambah ke history (object snapshot)
        const snapshot = {
          name: data.name,
          temp: targetTemp,
          description: data.weather[0].description,
          humidity: data.main.humidity,
          wind: data.wind.speed,
          icon: data.weather[0].icon,
          time: new Date().toLocaleString()
        };

        history.push(snapshot);
        renderHistory();
      } catch(err){
        result.classList.add("hidden");
        error.classList.remove("hidden");
      }
    }

    function renderHistory(){
      historyContainer.classList.remove("hidden");
      historyList.innerHTML = "";

      history.forEach((item, index)=>{
        const li = document.createElement("li");

        const btn = document.createElement("button");
        btn.className = "w-full text-left bg-soft px-4 py-2 rounded-lg hover:bg-gray-200 transition flex justify-between items-center";
        btn.textContent = item.name + " (" + item.time + ")";

        const arrow = document.createElement("span");
        arrow.textContent = "▼";
        btn.appendChild(arrow);

        const content = document.createElement("div");
        content.className = "collapse-content bg-white mt-2 p-3 border rounded-lg";
        content.innerHTML = `
          <p><strong>Suhu:</strong> ${item.temp}°C</p>
          <p><strong>Deskripsi:</strong> ${item.description}</p>
          <p><strong>Kelembapan:</strong> ${item.humidity}%</p>
          <p><strong>Angin:</strong> ${item.wind} m/s</p>
          <p><strong>Waktu Pencarian:</strong> ${item.time}</p>
        `;

        btn.addEventListener("click", ()=>{
          content.classList.toggle("show");
          arrow.textContent = content.classList.contains("show") ? "▲" : "▼";
        });

        li.appendChild(btn);
        li.appendChild(content);
        historyList.appendChild(li);
      });
    }

    // Tekan Enter untuk search
    cityInput.addEventListener("keypress", function(e){
      if(e.key==="Enter") getWeather();
    });
  </script>
</body>
</html>
