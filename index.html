<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WeatherNow Premium | Informasi Cuaca</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2563EB',
            secondary: '#1E40AF',
            soft: '#EFF6FF',
            rain: '#93C5FD',
            cloud: '#CBD5E1',
            sun: '#FDE68A',
            night: '#1E3A8A',
            cardDark: '#1E293B',
            textDark: '#F1F5F9'
          }
        }
      }
    }
  </script>

  <style>
    .weather-icon { animation: float 2s ease-in-out infinite; }
    @keyframes float { 0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);} }

    .collapse-content { display:none; max-height:0; overflow:hidden; transition:max-height 0.3s ease, padding 0.3s ease; }
    .collapse-content.show { display:block; max-height:500px; padding:0.75rem 1rem; }

    .dark-card { background-color:#1E293B !important; color:#F1F5F9 !important; }

    .btn { transition: all 0.3s; border-radius: 0.5rem; font-weight: 500; }
    .btn-primary { background-color:#2563EB; color:white; }
    .btn-primary:hover { background-color:#1E40AF; }
    .btn-unit { background-color:#E5E7EB; color:#1F2937; }
    .btn-unit:hover { background-color:#D1D5DB; }
  </style>
</head>
<body class="bg-soft min-h-screen flex flex-col items-center justify-start font-sans py-10 transition-colors duration-500">

  <div id="mainCard" class="bg-white w-full max-w-md rounded-2xl shadow-lg p-6 mb-6 transition-all duration-500">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-2xl font-semibold text-secondary">WeatherNow Premium</h1>
      <button id="modeToggle" class="btn btn-primary px-3 py-1">Dark Mode</button>
    </div>
    <p class="text-sm text-gray-500 text-center mb-6">Informasi cuaca realtime + forecast + chart</p>

    <div class="flex gap-2 mb-4">
      <input id="cityInput" type="text" placeholder="Masukkan nama kota" class="w-full border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary" />
      <button onclick="getWeather()" class="btn btn-primary px-4">Cari</button>
    </div>

    <div id="unitConverter" class="flex justify-center gap-4 mb-4 hidden">
      <button id="toC" class="btn btn-unit px-3 py-1">°C</button>
      <button id="toF" class="btn btn-unit px-3 py-1">°F</button>
    </div>

    <div id="result" class="hidden text-center">
      <h2 id="cityName" class="text-xl font-semibold text-secondary"></h2>
      <p id="localTime" class="text-gray-500 text-sm mb-2"></p>
      <img id="weatherIcon" class="mx-auto my-3 w-20 weather-icon" />
      <p id="temperature" class="text-4xl font-bold text-primary"></p>
      <p id="description" class="text-gray-600 capitalize mb-2"></p>

      <div class="grid grid-cols-2 gap-4 mt-4 text-sm">
        <div id="humidityCard" class="bg-soft rounded-lg p-3">
          <p class="text-gray-500">Kelembapan</p>
          <p id="humidity" class="font-semibold text-secondary"></p>
        </div>
        <div id="windCard" class="bg-soft rounded-lg p-3">
          <p class="text-gray-500">Angin</p>
          <p id="wind" class="font-semibold text-secondary"></p>
        </div>
      </div>

      <canvas id="tempChart" class="mt-6"></canvas>

      <div id="forecast" class="grid grid-cols-3 gap-2 mt-4 text-sm"></div>
    </div>

    <p id="error" class="text-center text-red-500 mt-4 hidden">Kota tidak ditemukan</p>
  </div>

  <div id="historyContainer" class="bg-white w-full max-w-md rounded-2xl shadow-lg p-4 mb-6 hidden">
    <h3 class="text-lg font-semibold text-secondary mb-2">History Pencarian</h3>
    <ul id="historyList" class="space-y-2 text-gray-700"></ul>
  </div>

  <script>
    const apiKey = "aff95024f4a44ffdb9f6676960870786";

    const cityInput = document.getElementById("cityInput");
    const result = document.getElementById("result");
    const error = document.getElementById("error");
    const cityName = document.getElementById("cityName");
    const localTime = document.getElementById("localTime");
    const temperature = document.getElementById("temperature");
    const description = document.getElementById("description");
    const humidity = document.getElementById("humidity");
    const wind = document.getElementById("wind");
    const weatherIcon = document.getElementById("weatherIcon");
    const historyContainer = document.getElementById("historyContainer");
    const historyList = document.getElementById("historyList");
    const forecastDiv = document.getElementById("forecast");
    const tempChart = document.getElementById("tempChart");
    const modeToggle = document.getElementById("modeToggle");
    const toC = document.getElementById("toC");
    const toF = document.getElementById("toF");
    const unitConverter = document.getElementById("unitConverter");
    const mainCard = document.getElementById("mainCard");
    const humidityCard = document.getElementById("humidityCard");
    const windCard = document.getElementById("windCard");

    let history = [];
    let chartInstance = null;
    let unit = "C";

    modeToggle.addEventListener("click", ()=>{
      mainCard.classList.toggle("dark-card");
      humidityCard.classList.toggle("dark-card");
      windCard.classList.toggle("dark-card");
      historyContainer.classList.toggle("dark-card");

      const forecastCards = forecastDiv.querySelectorAll("div");
      forecastCards.forEach(c=>c.classList.toggle("dark-card"));

      const historyCards = historyList.querySelectorAll("li > button, li > .collapse-content");
      historyCards.forEach(c=>c.classList.toggle("dark-card"));

      modeToggle.textContent = mainCard.classList.contains("dark-card") ? "Light Mode" : "Dark Mode";
    });

    toC.addEventListener("click", ()=>{ unit="C"; updateTemperatureDisplay(); });
    toF.addEventListener("click", ()=>{ unit="F"; updateTemperatureDisplay(); });

    function updateTemperatureDisplay(){
      if(history.length===0) return;
      const last = history[history.length-1];
      temperature.textContent = unit==="C" ? last.temp+"°C" : Math.round(last.temp*9/5+32)+"°F";
      if(chartInstance){
        chartInstance.data.datasets[0].data = last.forecast.map(f=> unit==="C"?f.temp:f.temp*9/5+32 );
        chartInstance.update();
      }
      const cards = forecastDiv.querySelectorAll(".forecast-temp");
      cards.forEach((c,i)=>{ c.textContent = unit==="C"?last.forecast[i].temp+"°C":Math.round(last.forecast[i].temp*9/5+32)+"°F"; });
    }

    async function getWeather(){
      const city = cityInput.value.trim();
      if(!city) return;

      try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&lang=id&appid=${apiKey}`);
        if(!response.ok) throw new Error("Kota tidak ditemukan");
        const data = await response.json();

        unitConverter.classList.remove("hidden");

        const mainWeather = data.weather[0].main.toLowerCase();
        const bodyClass = ["min-h-screen","flex","flex-col","items-center","justify-start","font-sans","py-10","transition-colors","duration-500"];
        switch(mainWeather){
          case 'clear': bodyClass.push("bg-sun"); break;
          case 'clouds': bodyClass.push("bg-cloud"); break;
          case 'rain': case 'drizzle': bodyClass.push("bg-rain"); break;
          case 'thunderstorm': bodyClass.push("bg-secondary"); break;
          default: bodyClass.push("bg-soft");
        }
        document.body.className = bodyClass.join(" ");

        cityName.textContent = data.name;
        const local = new Date(new Date().getTime() + data.timezone*1000 - new Date().getTimezoneOffset()*60000);
        localTime.textContent = "Waktu lokal: "+local.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});

        let temp = 0; const targetTemp=Math.round(data.main.temp);
        temperature.textContent="0°C";
        const interval=setInterval(()=>{ if(temp>=targetTemp){ clearInterval(interval); updateTemperatureDisplay(); } else{ temp++; temperature.textContent=temp+"°C"; } },30);

        description.textContent=data.weather[0].description;
        humidity.textContent=data.main.humidity+"%";
        wind.textContent=data.wind.speed+" m/s";
        weatherIcon.src=`https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;

        result.classList.remove("hidden");
        error.classList.add("hidden");

        const forecastResp = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&units=metric&lang=id&appid=${apiKey}`);
        const forecastData = await forecastResp.json();
        const forecastList = forecastData.list.filter((f,i)=> i%8===0).slice(0,3).map((f,i)=>({
          temp: Math.round(f.main.temp),
          desc: f.weather[0].description,
          icon: f.weather[0].icon,
          prob: f.pop?Math.round(f.pop*100):0,
          day: i===0?"Hari ini":i===1?"Besok":"Lusa"
        }));

        forecastDiv.innerHTML = "";
forecastList.forEach(f => {
  const card = document.createElement("div");
  card.className = "bg-soft p-2 rounded-lg text-center";

  if(mainCard.classList.contains("dark-card")) card.classList.add("dark-card");

  card.innerHTML = `
    <p class="font-semibold ${mainCard.classList.contains("dark-card") ? 'text-textDark' : ''}">${f.day}</p>
    <img class="mx-auto w-12" src="https://openweathermap.org/img/wn/${f.icon}@2x.png">
    <p class="forecast-temp ${mainCard.classList.contains("dark-card") ? 'text-textDark' : ''}">${unit==="C"?f.temp:f.temp*9/5+32}°${unit}</p>
    <p class="capitalize ${mainCard.classList.contains("dark-card") ? 'text-textDark' : ''}">${f.desc}</p>
    <p class="${mainCard.classList.contains("dark-card") ? 'text-textDark' : ''}">Probabilitas hujan: ${f.prob}%</p>
  `;
  forecastDiv.appendChild(card);
});


        if(chartInstance) chartInstance.destroy();
        chartInstance = new Chart(tempChart,{
          type:"line",
          data:{
            labels:forecastList.map(f=>f.day),
            datasets:[{label:"Suhu", data:forecastList.map(f=>unit==="C"?f.temp:f.temp*9/5+32), borderColor:"#2563EB", backgroundColor:"rgba(37,99,235,0.2)", tension:0.3}]
          },
          options:{responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:false}}}
        });

        const snapshot={ name:data.name, temp:targetTemp, description:data.weather[0].description, humidity:data.main.humidity, wind:data.wind.speed, icon:data.weather[0].icon, time:new Date().toLocaleString(), forecast:forecastList };
        history.push(snapshot);
        renderHistory();

      }catch(err){
        result.classList.add("hidden");
        error.classList.remove("hidden");
      }
    }

    function renderHistory(){
      historyContainer.classList.remove("hidden");
      historyList.innerHTML="";
      history.forEach((item)=>{
        const li=document.createElement("li");
        const btn=document.createElement("button");
        btn.className="w-full text-left bg-soft px-4 py-2 rounded-lg hover:bg-gray-200 transition flex justify-between items-center";
        btn.textContent=item.name+" ("+item.time+")";
        const arrow=document.createElement("span"); arrow.textContent="▼";
        btn.appendChild(arrow);

        const content=document.createElement("div");
        content.className="collapse-content bg-white mt-2 p-3 border rounded-lg";
        content.innerHTML=`<p><strong>Suhu:</strong> ${item.temp}°C</p><p><strong>Deskripsi:</strong> ${item.description}</p><p><strong>Kelembapan:</strong> ${item.humidity}%</p><p><strong>Angin:</strong> ${item.wind} m/s</p><p><strong>Waktu Pencarian:</strong> ${item.time}</p>`;

        btn.addEventListener("click",()=>{
          content.classList.toggle("show");
          arrow.textContent = content.classList.contains("show")?"▲":"▼";
        });

        li.appendChild(btn);
        li.appendChild(content);
        historyList.appendChild(li);
      });
    }

    cityInput.addEventListener("keypress",function(e){ if(e.key==="Enter") getWeather(); });
  </script>
</body>
</html>
  
